<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Form</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        .user-info, .address-info {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .label {
            font-weight: bold;
            margin-right: 5px;
        }
        #update-form {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        #update-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        #update-form input[type="text"] {
            width: 300px;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #aaa;
            border-radius: 3px;
        }
        #update-button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        #update-button:hover {
            background-color: #0056b3;
        }
        #message {
            margin-top: 15px;
            font-weight: bold;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>

    <div class="user-info">
        <h3>User Information</h3>
        <p><span class="label">Name:</span> <span id="user-name"></span></p>
        <p><span class="label">Email:</span> <span id="user-email"></span></p>
    </div>

    <div class="address-info">
        <h3>Address Information</h3>
        <p><span class="label">City:</span> <span id="address-city"></span></p>
        <p><span class="label">Country:</span> <span id="address-country"></span></p>
    </div>

    <div id="update-form">
        <h3>Update Information</h3>
        <label for="name">Name:</label>
        <input type="text" id="name" name="name"><br>
        <label for="email">Email:</label>
        <input type="text" id="email" name="email"><br>
        <label for="city">City:</label>
        <input type="text" id="city" name="city"><br>
        <label for="country">Country:</label>
        <input type="text" id="country" name="country"><br>
        <button id="update-button">Update Information</button>
        <div id="message"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Function to fetch user data via AJAX
            function fetchUserData() {
                $.ajax({
                    url: '/user/data', // Replace with your actual API endpoint to fetch user data
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        if (data.user) {
                            $('#user-name').text(data.user.name);
                            $('#user-email').text(data.user.email);
                        }
                        if (data.address) {
                            $('#address-city').text(data.address.city);
                            $('#address-country').text(data.address.country);
                        }
                        // Populate the update form with existing data
                        $('#name').val(data.user ? data.user.name : '');
                        $('#email').val(data.user ? data.user.email : '');
                        $('#city').val(data.address ? data.address.city : '');
                        $('#country').val(data.address ? data.address.country : '');
                    },
                    error: function(error) {
                        console.error('Error fetching user data:', error);
                        $('#message').text('Error loading user information.').addClass('error');
                    }
                });
            }

            // Call fetchUserData when the page loads
            fetchUserData();

            // Event listener for the update button
            $('#update-button').on('click', function() {
                const updatedData = {
                    user: {
                        name: $('#name').val(),
                        email: $('#email').val()
                    },
                    address: {
                        city: $('#city').val(),
                        country: $('#country').val()
                    }
                };

                $.ajax({
                    url: '/user/update', // Replace with your actual API endpoint to update user data
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(updatedData),
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            $('#message').text('Information updated successfully!').removeClass('error').addClass('success');
                            // Optionally, refresh the displayed data
                            fetchUserData();
                        } else {
                            $('#message').text('Failed to update information: ' + response.message).removeClass('success').addClass('error');
                        }
                    },
                    error: function(error) {
                        console.error('Error updating user data:', error);
                        $('#message').text('Error communicating with the server.').removeClass('success').addClass('error');
                    }
                });
            });
        });
    </script>

</body>
</html>